<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Central de Atendimento</title>

<style>
body { font-family: Arial, sans-serif; margin:0; background:#f4f4f4; }
header { background:#2f3e46; color:#fff; padding:14px; text-align:center; font-weight:bold; }

.tabs { display:flex; background:#cad2c5; }
.tab { padding:10px 16px; cursor:pointer; border-right:1px solid #999; }
.tab.active { background:#fff; font-weight:bold; }

.content {
  display:none;
  padding:16px;
  background:#fff;
  height:calc(100vh - 90px);
  overflow-y:auto;
}
.content.active { display:block; }

button { padding:8px 10px; cursor:pointer; font-size:13px; }

label { font-weight:bold; display:block; margin-top:10px; }
input, textarea {
  width:100%; padding:8px; margin-top:4px; box-sizing:border-box;
}
textarea { resize:vertical; }

.btn-full {
  width:100%; margin-top:14px;
  background:#2f3e46; color:#fff; border:none; font-weight:bold;
}

.presets { display:grid; grid-template-columns:1fr; gap:8px; margin-top:12px; }

table {
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}
th, td {
  border:1px solid #ccc;
  padding:8px;
  font-size:13px;
  vertical-align:top;
}
th { background:#eee; }

.acoes {
  display:flex;
  gap:10px;
  justify-content:center;
}

.icon-btn {
  background:none;
  border:none;
  font-size:18px;
  cursor:pointer;
  padding:0;
}

.icon-btn:hover {
  opacity:0.7;
}

.modal {
  display:none; position:fixed; inset:0;
  background:rgba(0,0,0,.4); z-index:20;
}
.modal-content {
  background:#fff; padding:20px; width:300px;
  margin:120px auto;
}
</style>
</head>

<body>

<header>CENTRAL DE ATENDIMENTO</header>

<div class="tabs">
  <div class="tab active" onclick="openTab(event,'comentarios')">Coment√°rios</div>
  <div class="tab" onclick="openTab(event,'pendencias')">Pend√™ncias</div>
</div>

<!-- ================= COMENT√ÅRIOS ================= -->
<div id="comentarios" class="content active">

  <label>Matr√≠cula</label>
  <input id="matricula">

  <label>Protocolo</label>
  <input id="protocolo" oninput="gerarInicio()">

  <label>Coment√°rio</label>
  <textarea id="comentario" rows="4"></textarea>

  <div class="presets">
    <button onclick="usarPresetSimples('2¬™ FATURA ENVIADA')">2¬™ FATURA ENVIADA</button>

    <button onclick="presetVariavel(
      'SERVI√áO SOLICITADO E N√ÉO PRESTADO ‚Äì {VAR} ‚Äì ENVIADO VIA FORMS',
      'Digite o tipo de servi√ßo'
    )">Servi√ßo n√£o prestado ‚Äì Forms</button>

    <button onclick="presetVariavel(
      'SERVI√áO SOLICITADO E N√ÉO PRESTADO ‚Äì {VAR} ‚Äì ENVIADO PARA SUPERVISORA',
      'Digite o tipo de servi√ßo'
    )">Servi√ßo n√£o prestado ‚Äì Supervisora</button>
  </div>

  <button class="btn-full" onclick="copiarComentario()">COPIAR COMENT√ÅRIO</button>
  <button class="btn-full" onclick="salvarPendencia()">SALVAR PEND√äNCIA</button>
</div>

<!-- ================= PEND√äNCIAS ================= -->
<div id="pendencias" class="content">
  <table>
    <thead>
      <tr>
        <th>Matr√≠cula</th>
        <th>Coment√°rio</th>
        <th>A√ß√µes</th>
      </tr>
    </thead>
    <tbody id="listaPendencias"></tbody>
  </table>
</div>

<!-- MODAL VARI√ÅVEL -->
<div id="modalVar" class="modal">
  <div class="modal-content">
    <label id="labelVar"></label>
    <input id="inputVar">
    <button class="btn-full" onclick="confirmarVariavel()">OK</button>
  </div>
</div>

<script>
let tipoAtendimento = "CALL CENTER";
let modeloAtual = "";

let pendencias = JSON.parse(localStorage.getItem("pendencias") || "[]");

const protocoloInput = document.getElementById("protocolo");
const comentario = document.getElementById("comentario");

function openTab(evt,id){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.content').forEach(c=>c.classList.remove('active'));
  evt.target.classList.add('active');
  document.getElementById(id).classList.add('active');
}

function gerarInicio() {
  const protocolo = protocoloInput.value.trim();
  if (!protocolo) return;
  const inicio = `${tipoAtendimento} PROTOCOLO: ${protocolo} - `;
  if (!comentario.value.startsWith(inicio)) comentario.value = inicio;
}

function usarPresetSimples(txt) {
  if (!comentario.value.endsWith(" ")) comentario.value += " ";
  comentario.value += txt;
}

function presetVariavel(modelo, label) {
  modeloAtual = modelo;
  labelVar.innerText = label;
  inputVar.value = "";
  modalVar.style.display = "block";
  inputVar.focus();
}

function confirmarVariavel() {
  const valor = inputVar.value.trim().toUpperCase();
  if (!valor) return;
  if (!comentario.value.endsWith(" ")) comentario.value += " ";
  comentario.value += modeloAtual.replace("{VAR}", valor);
  modalVar.style.display = "none";
}

inputVar.addEventListener("keydown", e => {
  if (e.key === "Enter") confirmarVariavel();
});

function copiarComentario() {
  const txt = comentario.value.replace(/\n/g," ").toUpperCase();
  navigator.clipboard.writeText(txt);
  alert("Coment√°rio copiado!");
}

function salvarPendencia() {
  const mat = document.getElementById("matricula").value.trim();
  const txt = comentario.value.trim();
  if (!mat || !txt) return alert("Matr√≠cula e coment√°rio s√£o obrigat√≥rios.");

  pendencias.push({mat, txt});
  localStorage.setItem("pendencias", JSON.stringify(pendencias));
  atualizarTabela();
  alert("Pend√™ncia salva!");
}

function atualizarTabela() {
  const tbody = document.getElementById("listaPendencias");
  tbody.innerHTML = "";

  pendencias.forEach((p,i)=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${p.mat}</td>
      <td>${p.txt}</td>
      <td>
        <div class="acoes">
          <button class="icon-btn" title="Copiar coment√°rio"
            onclick="copiarTexto('${p.txt.replace(/'/g,"")}')">üìÑ</button>
          <button class="icon-btn" title="Excluir pend√™ncia"
            onclick="excluirPendencia(${i})">üóëÔ∏è</button>
        </div>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

function copiarTexto(txt){
  navigator.clipboard.writeText(txt.toUpperCase());
}

function excluirPendencia(i){
  pendencias.splice(i,1);
  localStorage.setItem("pendencias", JSON.stringify(pendencias));
  atualizarTabela();
}

// Carrega pend√™ncias ao abrir
atualizarTabela();
</script>

</body>
</html>
