<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Central de Atendimento</title>

<script>
/* ================== TABS ================== */
function openTab(evt, id) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
  evt.target.classList.add('active');
  document.getElementById(id).classList.add('active');
}

/* ================== COMENT√ÅRIOS ================== */
function canalSelect() {
  return document.getElementById("canal");
}

function atualizarPrefixo() {
  const canal = canalSelect().value;
  const p = protocolo.value.trim();
  if (!p) return;
  comentario.value = `${canal} PROTOCOLO: ${p} - `;
}

function adicionarTexto(txt) {
  if (!comentario.value.includes("PROTOCOLO")) atualizarPrefixo();
  if (!comentario.value.endsWith(" ")) comentario.value += " ";
  comentario.value += txt;
}

function copiarComentario() {
  navigator.clipboard.writeText(comentario.value.toUpperCase());
}

function atalhoServico(destino) {
  const tipo = prompt("Informe o tipo de servi√ßo:");
  if (!tipo) return;
  adicionarTexto(`SERVI√áO SOLICITADO E N√ÉO PRESTADO - ${tipo.toUpperCase()} - ENVIADO PARA ${destino}`);
}

function atalhoSegundaVia() {
  adicionarTexto("2¬™ FATURA AGORA - ENVIADA");
}

function atalhoFaltaAgua() {
  adicionarTexto("INFORMA FALTA DE √ÅGUA - ABERTURA DE SOLICITA√á√ÉO");
}

function atalhoAbastecimento() {
  const previsao = prompt("Informe a previs√£o (ex: 14H 22/09):");
  if (!previsao) return;
  adicionarTexto(`VERIFICA√á√ÉO SITUA√á√ÉO ABASTECIMENTO ‚Äì EXECUTADA (PREVIS√ÉO RETORNO ${previsao.toUpperCase()})`);
}

/* ================== PEND√äNCIAS ================== */
let pendencias = JSON.parse(localStorage.getItem("pendencias") || "[]");

function salvarPendencia() {
  const mat = prompt("Informe a matr√≠cula:");
  if (!mat) return;
  pendencias.push({ matricula: mat, texto: comentario.value });
  localStorage.setItem("pendencias", JSON.stringify(pendencias));
  carregarPendencias();
  alert("Pend√™ncia salva");
}

function carregarPendencias() {
  const tbody = document.getElementById("listaPendencias");
  tbody.innerHTML = "";
  pendencias.forEach((p, i) => {
    tbody.innerHTML += `
      <tr>
        <td>${p.matricula}</td>
        <td>${p.texto.slice(0,60)}...</td>
        <td>
          <span class="icon-btn" onclick="navigator.clipboard.writeText('${p.matricula}')">üìã</span>
          <span class="icon-btn" onclick="navigator.clipboard.writeText('${p.texto.replace(/'/g,"")}')">üìÑ</span>
          <span class="icon-btn" onclick="excluirPendencia(${i})">üóë</span>
        </td>
      </tr>
    `;
  });
}

function excluirPendencia(i) {
  if (!confirm("Excluir pend√™ncia?")) return;
  pendencias.splice(i,1);
  localStorage.setItem("pendencias", JSON.stringify(pendencias));
  carregarPendencias();
}

/* ================== PARALELAS ================== */
function carregarParalela() {
  const tipo = tipoParalela.value;
  let texto = "";

  if (tipo === "cancelamento") texto =
`CANCELAMENTO DE SOLICITA√á√ÉO

MATR√çCULA:
CIDADE:
PROTOCOLO DO ATENDIMENTO:
SERVI√áO QUE O CLIENTE SOLICITA O CANCELAMENTO:
N¬∫ SOLICITA√á√ÉO:
MOTIVO DO CANCELAMENTO:`;

  if (tipo === "pipa") texto =
`CAMINH√ÉO PIPA

PROTOCOLO DO ATENDIMENTO:
BAIRRO:
CIDADE:
MATR√çCULA:
ENDERE√áO:
CELULAR PARA CONTATO:`;

  if (tipo === "retificacao") texto =
`(SERVI√áO) FORA DO PRAZO, REFERENTE √Ä COMPET√äNCIA: XX/XXXX.
DATA DA SOLICITA√á√ÉO:
MATR√çCULA:
CIDADE:
PROTOCOLO DO ATENDIMENTO:`;

  if (tipo === "debito") texto =
`BLOQUEAR D√âBITO EM CONTA

MATR√çCULA:
CIDADE:
PROTOCOLO DO ATENDIMENTO:
VENCIMENTO: XX/XX/XXXX
VALOR: R$
COMPET√äNCIA: XX/XXXX`;

  if (tipo === "exclusao") texto =
`EXCLUS√ÉO DE CADASTRO DO SITE/APP

NOME COMPLETO:
MATR√çCULA:
CONCESS√ÉO: CORSAN
CPF OU CNPJ CADASTRADO:
E-MAIL CADASTRADO:
CPF OU CNPJ CORRETO:
MOTIVO DA SOLICITA√á√ÉO DE EXCLUS√ÉO: DADOS INCORRETOS`;

  if (tipo === "religacao") texto =
`RELIGA√á√ÉO POR CORTE INDEVIDO ‚Äì REGIONAL ‚Äì O.S. XXXXXXX ‚Äì PROTOCOLO: XXXXXXX

MATR√çCULA:
CIDADE:
PROTOCOLO DO ATENDIMENTO:
VENCIMENTO: XX/XX/XXXX`;

  textoParalela.value = texto;
}

function copiarParalela() {
  navigator.clipboard.writeText(textoParalela.value);
}

/* ================== O.S. ================== */
const OS_CONFIG = {
  "148005": {
    titulo: "OS 148005 ‚Äì TROCA DE TITULARIDADE - ATENDIMENTO",
    instrucoes: [
      "Fazer a troca manual.",
      "Encerramento autom√°tico.",
      "Utilizada para fins quantitativos."
    ],
    tipo: "estruturado",
    campos: [
      "CLIENTE ATUAL",
      "NOVO CLIENTE",
      "DATA INICIAL CONTRATO",
      "DOCUMENTOS ANEXOS: ( ) SIM ( ) N√ÉO",
      "OBSERVA√á√ïES"
    ]
  },

  "248005_exc": {
    titulo: "OS 248005 ‚Äì TROCA DE TITULARIDADE - CADASTRO",
    instrucoes: [
      "Anexar documenta√ß√£o obrigat√≥ria."
    ],
    tipo: "estruturado",
    campos: [
      "CLIENTE ATUAL",
      "NOVO CLIENTE",
      "DATA INICIAL CONTRATO",
      "DOCUMENTOS ANEXOS: ( ) SIM ( ) N√ÉO",
      "OBSERVA√á√ïES"
    ]
  },

  "248005_mov": {
    titulo: "OS 248005 ‚Äì TROCA DE TITULARIDADE - CADASTRO",
    instrucoes: [
      "Troca com movimenta√ß√£o de d√©bitos.",
      "Obrigat√≥ria abertura da OS 148006."
    ],
    tipo: "estruturado",
    campos: [
      "CLIENTE ATUAL",
      "NOVO CLIENTE",
      "DATA INICIAL CONTRATO",
      "DOCUMENTOS ANEXOS: ( ) SIM ( ) N√ÉO",
      "OBSERVA√á√ïES"
    ],
    gera148006: true
  },

  "103002": {
    titulo: "OS 103002 ‚Äì AN√ÅLISE BENEF√çCIO - TARIFA SOCIAL",
    instrucoes: [
      "Abrir somente com documenta√ß√£o obrigat√≥ria."
    ],
    tipo: "estruturado",
    campos: [
      "NOME SOLICITANTE",
      "V√çNCULO COM IM√ìVEL",
      "TELEFONE",
      "DOCUMENTOS ANEXADOS? ( ) SIM ( ) N√ÉO"
    ]
  },

  "102002": {
    titulo: "OS 102002 ‚Äì VERIFICA√á√ÉO CADASTRAL",
    instrucoes: [],
    tipo: "estruturado",
    campos: [
      "NOME SOLICITANTE",
      "V√çNCULO COM IM√ìVEL",
      "TELEFONE",
      "SOLICITA√á√ÉO DESEJADA"
    ]
  },

  "118061": {
    titulo: "OS 118061 ‚Äì AN√ÅLISE SUPRESS√ÉO DE ESGOTO",
    instrucoes: [
      "Somente para faturamento de esgoto ativo.",
      "Disponibilidade usar OS 145042."
    ],
    tipo: "estruturado",
    campos: [
      "MOTIVO DA SOLICITA√á√ÉO",
      "TELEFONE"
    ]
  },

  "119001": {
    titulo: "OS 119001 ‚Äì VAZAMENTO NO QUADRO",
    instrucoes: [
      "Responder todas as perguntas operacionais.",
      "Prazo 24h."
    ],
    tipo: "livre"
  },

  "138001": {
    titulo: "OS 138001 ‚Äì VAZAMENTO NA RUA OU CAL√áADA",
    instrucoes: [
      "Endere√ßo completo.",
      "Ponto de refer√™ncia.",
      "Prazo 48h."
    ],
    tipo: "livre"
  },

  "146004": {
    titulo: "OS 146004 ‚Äì FALTA DE √ÅGUA",
    instrucoes: [
      "Prazo 24h."
    ],
    tipo: "estruturado",
    campos: [
      "REGISTRO ABERTO",
      "BAIRRO",
      "VIZINHOS T√äM √ÅGUA",
      "CELULAR"
    ]
  }
};

function iniciarOS() {
  const tipo = osTipo.value;
  if (!tipo || !osNome.value || !osTelefone.value) {
    alert("Preencha tipo de O.S., nome e telefone.");
    return;
  }

  const cfg = OS_CONFIG[tipo];
  document.getElementById("os-step-1").style.display = "none";
  document.getElementById("os-step-2").style.display = "block";

  osInstrucoes.innerHTML = "<b>INFORMA√á√ïES ADICIONAIS</b><br>" + cfg.instrucoes.join("<br>");
  osCampos.innerHTML = "";
  osTexto.value = cfg.titulo.toUpperCase() + "\n\n";

  if (cfg.tipo === "estruturado") {
    cfg.campos.forEach(c => osTexto.value += c + ":\n");
  }

  btn148006.style.display = cfg.gera148006 ? "block" : "none";
}

function gerar148006() {
  osTexto.value +=
`\n\nOS 148006 ‚Äì TRANSFER√äNCIA DE D√âBITOS
CLIENTE ATUAL:
NOVO CLIENTE:
REFER√äNCIAS A MOVIMENTAR:
OBSERVA√á√ïES:`.toUpperCase();
}

function copiarOSTexto() {
  navigator.clipboard.writeText(osTexto.value.toUpperCase());
}

document.addEventListener("DOMContentLoaded", carregarPendencias);
</script>

<style>
/* CSS IGUAL AO SEU, SEM ALTERA√á√ÉO FUNCIONAL */
body{margin:0;font-family:Arial,sans-serif;background:#f4f4f4}
header{background:#2f3e46;color:#fff;padding:14px;text-align:center;font-weight:bold}
.tabs{display:flex;background:#cad2c5}
.tab{padding:10px 16px;cursor:pointer;border-right:1px solid #999}
.tab.active{background:#fff;font-weight:bold}
.content{display:none;padding:16px;background:#fff;height:calc(100vh - 90px);overflow-y:auto}
.content.active{display:block}
label{font-weight:bold;display:block;margin-top:10px}
input,textarea,select{width:100%;padding:8px;margin-top:4px;box-sizing:border-box}
textarea{resize:vertical}
button{padding:10px;margin-top:10px;cursor:pointer}
.btn{background:#2f3e46;color:#fff;border:none;font-weight:bold}
.btn-full{width:100%}
.row{display:flex;gap:10px}
.row button{flex:1}
.box{background:#eee;padding:10px;margin-top:10px;font-size:13px}
.table{width:100%;border-collapse:collapse;margin-top:10px}
.table th,.table td{border:1px solid #ccc;padding:6px;font-size:13px}
.icon-btn{cursor:pointer;margin-right:6px}
</style>
</head>

<body>

<header>CENTRAL DE ATENDIMENTO</header>

<div class="tabs">
  <div class="tab active" onclick="openTab(event,'comentarios')">Coment√°rios</div>
  <div class="tab" onclick="openTab(event,'pendencias')">Pend√™ncias</div>
  <div class="tab" onclick="openTab(event,'paralelas')">Paralelas</div>
  <div class="tab" onclick="openTab(event,'os')">O.S.</div>
</div>

<!-- COMENT√ÅRIOS -->
<div id="comentarios" class="content active">
  <label>Canal</label>
  <select id="canal">
    <option>CALL CENTER</option>
    <option>LOJA</option>
  </select>

  <label>Protocolo</label>
  <input id="protocolo" oninput="atualizarPrefixo()">

  <label>Coment√°rio</label>
  <textarea id="comentario" rows="4"></textarea>

  <div class="row">
    <button class="btn" onclick="atalhoServico('FORMS')">Servi√ßo n√£o prestado ‚Äì Forms</button>
    <button class="btn" onclick="atalhoServico('SUPERVISORA')">Servi√ßo n√£o prestado ‚Äì Supervisora</button>
  </div>

  <button class="btn btn-full" onclick="atalhoSegundaVia()">2¬™ VIA ENVIADA</button>
  <button class="btn btn-full" onclick="atalhoAbastecimento()">Verifica√ß√£o situa√ß√£o abastecimento</button>
  <button class="btn btn-full" onclick="atalhoFaltaAgua()">Informa falta de √°gua</button>

  <div class="row">
    <button class="btn" onclick="copiarComentario()">COPIAR</button>
    <button class="btn" onclick="salvarPendencia()">SALVAR PEND√äNCIA</button>
  </div>
</div>

<!-- PEND√äNCIAS -->
<div id="pendencias" class="content">
  <table class="table">
    <thead>
      <tr><th>Matr√≠cula</th><th>Coment√°rio</th><th>A√ß√µes</th></tr>
    </thead>
    <tbody id="listaPendencias"></tbody>
  </table>
</div>

<!-- PARALELAS -->
<div id="paralelas" class="content">
  <div class="box">
    <b>SUPERVISORES</b><br>
    kleber.filho@aeparceiros.com.br<br>
    victoria.ferreira@aeparceiros.com.br<br>
    barbara.piva@aeparceiros.com.br
  </div>

  <label>Tipo de paralela</label>
  <select id="tipoParalela" onchange="carregarParalela()">
    <option value="">Selecione</option>
    <option value="cancelamento">Cancelamento</option>
    <option value="pipa">Caminh√£o pipa</option>
    <option value="retificacao">Retifica√ß√£o fora do prazo</option>
    <option value="debito">Bloquear d√©bito</option>
    <option value="exclusao">Exclus√£o cadastro</option>
    <option value="religacao">Religa√ß√£o corte indevido</option>
  </select>

  <label>Texto do e-mail</label>
  <textarea id="textoParalela" rows="10"></textarea>
  <button class="btn btn-full" onclick="copiarParalela()">COPIAR</button>
</div>

<!-- O.S. -->
<div id="os" class="content">
  <div id="os-step-1">
    <label>Tipo de O.S.</label>
    <select id="osTipo">
      <option value="">Selecione</option>
      <option value="148005">148005 ‚Äì Troca de titularidade (manual)</option>
      <option value="248005_exc">248005 ‚Äì Troca de titularidade (exce√ß√µes)</option>
      <option value="248005_mov">248005 ‚Äì Troca de titularidade (movimenta√ß√£o)</option>
      <option value="103002">103002 ‚Äì Tarifa social</option>
      <option value="102002">102002 ‚Äì Verifica√ß√£o cadastral</option>
      <option value="118061">118061 ‚Äì Supress√£o de esgoto</option>
      <option value="119001">119001 ‚Äì Vazamento no quadro</option>
      <option value="138001">138001 ‚Äì Vazamento rua/cal√ßada</option>
      <option value="146004">146004 ‚Äì Falta de √°gua</option>
    </select>

    <label>Nome do cliente</label>
    <input id="osNome">

    <label>Telefone do cliente</label>
    <input id="osTelefone">

    <button class="btn btn-full" onclick="iniciarOS()">CONTINUAR</button>
  </div>

  <div id="os-step-2" style="display:none;">
    <div class="box" id="osInstrucoes"></div>
    <div id="osCampos"></div>

    <label>Texto da O.S.</label>
    <textarea id="osTexto" rows="10"></textarea>

    <button id="btn148006" class="btn btn-full" style="display:none;" onclick="gerar148006()">
      GERAR TEXTO OS 148006 ‚Äì TRANSFER√äNCIA DE D√âBITO
    </button>

    <button class="btn btn-full" onclick="copiarOSTexto()">COPIAR</button>
  </div>
</div>

</body>
</html>
